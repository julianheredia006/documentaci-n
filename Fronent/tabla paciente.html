<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Pacientes - AMBUSOS</title>
    <link rel="stylesheet" type="text/css" href="css.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
    <!------------------------------------------------- Header ---------------------------------------------------->
    <header class="header">
        <div class="topheader">
            <div class="wrapper"></div>
            <nav>
                <a onclick="location.href='../tipo_de_persona.html'">
                    <i class="fa-regular fa-user"></i> Inicia sesión
                </a>
            </nav>
        </div>
        <div class="wrapper">
            <div class="logo">
                <a onclick="location.href='../index.html'">
                    <img src="../img/logo_2.png" width="300px">
                </a>
            </div>
            <nav>
                <a href="../index.html">Inicio</a>
                <a href="../mapa_de_usuario.html">Mapa</a>
                <a href="../apartados_ambu.html">Otros</a>
            </nav>
        </div>
    </header>
    <!---------------------------------------------------------------------------------------------------------->

    <div class="texto-central text-center my-5">
        <h1>Gestión de Pacientes</h1>
    </div>

    <section class="container">
        <h4>Lista de Pacientes</h4>
        <div class="table-responsive">
            <table id="patientTable" class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Número de documento</th>
                        <th>Género</th>
                        <th>Seguro médico</th>
                        <th>Reporte Accidente</th>
                        <th>Fecha Reporte</th>
                        <th>Ubicación</th>
                        <th>EPS</th>
                        <th>Estado</th>
                        <th>Ambulancia ID</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td class="editable">María</td>
                        <td class="editable">Gómez</td>
                        <td class="editable">1028820252</td>
                        <td class="editable">Femenino</td>
                        <td class="editable">Polisa</td>
                        <td class="editable">Sin obstáculos</td>
                        <td class="editable">17/10/2024</td>
                        <td class="editable">Bosa centro</td>
                        <td class="editable">Sanitas</td>
                        <td class="editable">Crítico</td>
                        <td class="editable">1</td>
                        <td>
                            <button class="btn btn-primary btn-edit mb-2">Editar</button>
                            <button class="btn btn-danger btn-delete">Eliminar</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <button id="btnAdd" class="btn btn-success mt-3">Agregar</button>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const table = document.getElementById('patientTable').getElementsByTagName('tbody')[0];
            const btnAdd = document.getElementById('btnAdd');
            const role = new URLSearchParams(window.location.search).get('role');

            // Mostrar u ocultar características según el rol
            function setRoleFeatures(isAdmin) {
                document.querySelectorAll('.btn-delete').forEach(btn => {
                    btn.style.display = isAdmin ? "inline-block" : "none";
                });
            }
            setRoleFeatures(role === 'admin');

            // Agregar nueva fila
            btnAdd.addEventListener('click', function () {
                const newRow = table.insertRow();
                const newId = table.rows.length;

                // Crear celdas en la nueva fila
                for (let i = 0; i <= 12; i++) {
                    const cell = newRow.insertCell(i);
                    if (i === 0) {
                        // Asignar el ID auto-generado
                        cell.textContent = newId;
                    } else if (i === 12) {
                        // Crear las acciones (Editar/Eliminar)
                        cell.innerHTML = `
                            <button class="btn btn-primary btn-edit mb-2">Editar</button>
                            <button class="btn btn-danger btn-delete" style="display: ${role === 'admin' ? 'inline-block' : 'none'};">Eliminar</button>
                        `;
                    } else {
                        // Celdas editables vacías
                        cell.textContent = '';
                        cell.classList.add('editable');
                    }
                }

                // Agregar eventos a los botones en la nueva fila
                newRow.querySelector('.btn-edit').addEventListener('click', editRow);
                newRow.querySelector('.btn-delete').addEventListener('click', deleteRow);
            });

            // Editar fila
            function editRow() {
                const row = this.closest('tr');
                const editableCells = row.querySelectorAll('.editable');
                if (this.textContent === 'Editar') {
                    editableCells.forEach(cell => cell.setAttribute('contenteditable', 'true'));
                    this.textContent = 'Guardar';
                } else {
                    if (validateRow(row)) {
                        editableCells.forEach(cell => cell.setAttribute('contenteditable', 'false'));
                        this.textContent = 'Editar';
                    } else {
                        alert('Todos los campos deben estar llenos.');
                    }
                }
            }

            // Validar que no existan campos vacíos
            function validateRow(row) {
                return Array.from(row.querySelectorAll('.editable')).every(cell => cell.textContent.trim() !== '');
            }

            // Eliminar fila
            function deleteRow() {
                const row = this.closest('tr');
                row.remove();
                updateIds();
            }

            // Actualizar IDs de filas
            function updateIds() {
                const rows = table.getElementsByTagName('tr');
                for (let i = 0; i < rows.length; i++) {
                    rows[i].cells[0].textContent = i + 1;
                }
            }
        });
    </script>
</body>

</html>
